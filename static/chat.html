<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</title>
    <style>
        .admin-message {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</h2>
    <div id="chat-box"></div>
    <input type="text" id="message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

    <script>
        const chatID = new URLSearchParams(window.location.search).get("chat_id");
        const wsURL = `ws://${window.location.hostname}:8080/ws?chat_id=${chatID}`;
        console.log("üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket:", wsURL);

        const socket = new WebSocket(wsURL);

        socket.onopen = function() {
            console.log("‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω!", wsURL);
        };

        socket.onerror = function(event) {
            console.error("‚ùå –û—à–∏–±–∫–∞ WebSocket:", event);
            console.error("üõë WebSocket readyState:", socket.readyState);
        };

        socket.onclose = function(event) {
            console.warn("‚ö†Ô∏è WebSocket –∑–∞–∫—Ä—ã—Ç:", event);
        };

        socket.onmessage = function(event) {
            console.log("üì© –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:", event.data);

            const msg = JSON.parse(event.data);

            const chatBox = document.getElementById("chat-box");
            const messageElement = document.createElement("p");
            if (msg.sender === "–ê–¥–º–∏–Ω") {
                messageElement.classList.add("admin-message");
            }
            messageElement.innerHTML = `<strong>${msg.time || 'üõë –í–†–ï–ú–Ø –ù–ï –ü–†–ò–®–õ–û'}</strong> | <strong>${msg.sender}:</strong> ${msg.content}`;
            chatBox.appendChild(messageElement);
        };

        // ‚úÖ –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById("message");
            if (!input.value.trim()) return;

            const message = {
                chat_id: chatID,
                sender: "–ö–ª–∏–µ–Ω—Ç",
                content: input.value
            };

            console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:", message);
            socket.send(JSON.stringify(message));

            input.value = "";
        }
        
    </script>
</body>
</html>
